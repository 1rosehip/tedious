---
layout: default
title: API - BulkLoad
---

<h1>BulkLoad</h1>

<p>
  A <code>BulkLoad</code> instance is used to perform a bulk insert. 
  Use <a href="api-connection.html#function_newBulkLoad">connection.newBulkLoad</a> to create a new instance, 
  and <a href="api-connection.html#function_execBulkLoad">connection.execBulkLoad</a> to execute it 
  (see <a href="#usage">usage section</a>).
</p>

<ul class="toc">
  <li><a href="#usage">Usage</a></li>
  <li><a href="#function_addColumn">bulkLoad.addColumn(name, type, options)</a></li>
  <li><a href="#function_addRow">bulkLoad.addRow(row)</a></li>
  <li><a href="#function_getRowStream">bulkLoad.getRowStream()</a></li>
  <li><a href="#function_getTableCreationSql">bulkLoad.getTableCreationSql()</a></li>
</ul>

<h2 id="usage">Usage</h2>
{% highlight javascript %}

// optional BulkLoad options
var options = { keepNulls: true };

// instantiate - provide the table where you'll be inserting to, options and a callback
var bulkLoad = connection.newBulkLoad('MyTable', options, function (error, rowCount) {
  console.log('inserted %d rows', rowCount);
});

// setup your columns - always indicate whether the column is nullable
bulkLoad.addColumn('myInt', TYPES.Int, { nullable: false });
bulkLoad.addColumn('myString', TYPES.NVarChar, { length: 50, nullable: true });

// add rows
bulkLoad.addRow({ myInt: 7, myString: 'hello' });
bulkLoad.addRow({ myInt: 23, myString: 'world' });

// execute
connection.execBulkLoad(bulkLoad);
{% endhighlight %}

<div class="argument">
  <div class="name">options</div>
  <div class="description">
    <dl>
      <dt>
        <code>checkConstraints</code>
      </dt>
      <dd>
        <p>
          Honors constraints during bulk load, using T-SQL <a href="https://technet.microsoft.com/en-us/library/ms186247(v=sql.105).aspx">CHECK_CONSTRAINTS</a>. (default: <code>false</code>)
        </p>
      </dd>

      <dt>
        <code>fireTriggers</code>
      </dt>
      <dd>
        Honors insert triggers during bulk load, using the T-SQL <a href="https://technet.microsoft.com/en-us/library/ms187640(v=sql.105).aspx">FIRE_TRIGGERS</a>. (default: <code>false</code>)
      </dd>

      <dt>
        <code>keepNulls</code>
      </dt>
      <dd>
        Honors null value passed, ignores the default values set on table, using T-SQL <a href="https://msdn.microsoft.com/en-us/library/ms187887(v=sql.120).aspx">KEEP_NULLS</a>. (default: <code>false</code>)
      </dd>

      <dt>
        <code>tableLock</code>
      </dt>
      <dd>
        Places a bulk update(BU) lock on table while performing bulk load, using T-SQL <a href="https://technet.microsoft.com/en-us/library/ms180876(v=sql.105).aspx">TABLOCK</a>. (default: <code>false</code>)
      </dd>
      </dl>
  </div>
</div>

<h2 id="function_addColumn">bulkLoad.addColumn(name, type, options)</h2>
<p>
  Adds a column to the bulk load. The column definitions should match the table you are trying to insert into. 
  Attempting to call addColumn after the first row has been added will throw an exception.
</p>
{% highlight javascript %}
bulkLoad.addColumn('MyIntColumn', TYPES.Int, { nullable: false });
{% endhighlight %}
<div class="argument">
  <div class="name">name</div>
  <div class="description">
    <p>
      The name of the column.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">type</div>
  <div class="description">
    <p>
      One of the supported <a href="api-datatypes.html"><code>data types</code></a>.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">options</div>
  <div class="description">
    <p>
      Additional column type information. At a minimum, <code>nullable</code> must be set to true or false.
      <ul>
        <li><code>nullable</code> indicates whether the column accepts NULL values.</li>
        <li id="objName">
          <code>objName</code> If the name of the column is different from the name of the property found on 
          <code>rowObj</code> arguments passed to <a href="#function_addRow"></a>, then you can use this option
          to specify the property name.
        </li>
        <li><code>length</code> for VarChar, NVarChar, VarBinary</li>
        <li><code>precision</code> for Numeric, Decimal</li>
        <li><code>scale</code> for Numeric, Decimal, Time, DateTime2, DateTimeOffset</li>
      </ul>
    </p>
  </div>
</div>

<h2 id="function_addRow">bulkLoad.addRow(row)</h2>
<p>
  Adds a row to the bulk insert. This method accepts arguments in three different formats:
</p>
{% highlight javascript %}
bulkLoad.addRow( rowObj )
bulkLoad.addRow( columnArray )
bulkLoad.addRow( col0, col1, ... colN )
{% endhighlight %}
<div class="argument">
  <div class="name">rowObj</div>
  <div class="description">
    <p>
      An object of key/value pairs representing column name (or <a href="#objName">objName</a>) and value.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">columnArray</div>
  <div class="description">
    <p>
      An array representing the values of each column in the same order which they were added to the 
      bulkLoad object.
    </p>
  </div>
</div>
<div class="argument">
  <div class="name">col0, col1, ... colN</div>
  <div class="description">
    <p>
      If there are at least two columns, values can be passed as multiple arguments instead of an array. They 
      must be in the same order the columns were added in.
    </p>
  </div>
</div>

<h2 id="function_getRowStream">bulkLoad.getRowStream()</h2>
<p>
  Switches the <code>BulkLoad</code> object into streaming mode and returns a
  <a href="https://nodejs.org/dist/latest-v10.x/docs/api/stream.html#stream_writable_streams">writable stream</a>
  that can be used to send a large amount of rows to the server.
</p>
{% highlight javascript %}
const bulkLoad = connection.newBulkLoad(...);
bulkLoad.addColumn(...);
const rowStream = bulkLoad.getRowStream();
connection.execBulkLoad(bulkLoad);
rowSource.pipe(rowStream);
{% endhighlight %}
<p>
  In streaming mode, <code>bulkLoad.addRow()</code> cannot be used. Instead all data rows must be written to the returned stream object.
</p>
<p>
  The stream implementation uses data flow control to prevent memory overload.
  <code><a href="https://nodejs.org/dist/latest-v10.x/docs/api/stream.html#stream_writable_write_chunk_encoding_callback">stream.write()</a></code>
  returns <code>false</code> to indicate that data transfer should be paused.
  After that, the stream emits a <code><a href="https://nodejs.org/dist/latest-v10.x/docs/api/stream.html#stream_event_drain">'drain' event</a></code>
  when it is ready to resume data transfer.
</p>

<h2 id="function_getTableCreationSql">bulkLoad.getTableCreationSql()</h2>
<p>
  This is simply a helper utility function which returns a <code>CREATE TABLE</code> SQL statement based on the
  columns added to the bulkLoad object. This may be particularly handy when you want to insert into a temporary
  table (a table which starts with <code>#</code>).
</p>
{% highlight javascript %}
var sql = bulkLoad.getTableCreationSql();
{% endhighlight %}
<p>
  A side note on bulk inserting into temporary tables: if you want to access a local temporary table after
  executing the bulk load, you'll need to use the same connection and execute your requests using 
  <a href="api-connection.html#function_execSqlBatch">connection.execSqlBatch</a> instead of .execSql.
</p>
